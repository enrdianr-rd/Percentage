<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamlined Departmental Markdown Calculator</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --red-price: #cc2936; 

            /* Department Colors */
            --deli-bg: #fffbe6;     /* Light Yellow */
            --meat-bg: #fee2e2;     /* Light Red */
            --bakery-bg: #f0fff4;   /* Light Green */
            --success: #10b981;
            --danger: #ef4444;
            --info: #3b82f6;

            /* Meat Specific Colors for Clarity */
            --meat-header-bg: #fca5a5;  
            --action-reweight: #9d174d; /* Dark Pink for Scale */
            --action-sticker: #ca8a04;  /* Dark Yellow for Sticker */
            --action-system: #059669;   /* Teal for System Discount */
            --action-combined: #8a2be2; /* Blue-Violet for Scale + Sticker */
            --time-row-bg: #fce7f3; /* Light Pink for 1 Day Cuts Time Blocks */
            --chicken-bg: #e6ffec; /* Very Light Green for Chicken Section */
            --chicken-header: #99c6a1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            padding: 5px; /* Reduced body padding */
            margin: 0;
            line-height: 1.4;
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 900px;
            padding: 15px; /* Reduced container padding for mobile */
            border-radius: 12px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 15px; /* Reduced margin */
            font-size: 1.4rem; /* Slightly smaller H1 */
            color: var(--primary);
        }

        /* Input Section */
        .input-box {
            display: flex;
            flex-direction: column;
        }
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px; /* Reduced gap */
            margin-bottom: 20px;
        }
        
        label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 3px;
        }

        input {
            padding: 8px; /* Adjusted padding */
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1.1rem; /* Slightly larger for easier tapping */
        }

        /* Alerts */
        #managerAlert {
            background-color: var(--meat-bg);
            color: var(--danger);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
            border: 2px solid #f87171;
            display: none; 
        }

        /* Cost Display */
        .cost-display {
            background-color: #ecfdf5;
            border: 2px solid var(--success);
            color: #064e3b;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        .cost-display h2 {
            font-size: 0.75rem; /* Smaller sub-heading */
            margin-top: 0;
        }
        .cost-display .price-val {
            font-size: 1.6rem; /* Slightly smaller price */
            font-weight: 700;
        }

        /* Discount Grid */
        .discount-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 6px; /* Reduced gap */
            margin-bottom: 25px;
        }
        
        .discount-card {
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 2px; /* Reduced padding */
            text-align: center;
        }
        
        .cost-highlight {
            border-color: var(--success) !important;
            background-color: #ecfdf5 !important;
            box-shadow: 0 0 4px rgba(16, 185, 129, 0.5);
        }
        
        .discount-percent {
            font-size: 0.65rem; /* Smaller percentage label */
            padding: 1px 3px;
            margin-bottom: 3px;
        }

        .discount-price-container {
            font-size: 0.8rem;
        }
        .original-price {
            font-size: 0.75rem; /* Smaller original price */
        }
        .rounded-price {
            font-size: 0.95rem; /* Slightly smaller rounded price */
        }

        /* --- Department Reference Grids --- */
        .department-grid {
            display: flex;
            flex-direction: column; 
            gap: 15px; 
            padding-top: 5px;
        }
        
        .reference-section {
            border-radius: 10px;
            padding: 12px; /* Reduced section padding */
        }
        
        /* Department Specific Styling (No change) */
        .deli-rules { background-color: var(--deli-bg); border: 2px solid #facc15; }
        .meat-rules { background-color: var(--meat-bg); border: 2px solid #f87171; }
        .bakery-rules { background-color: var(--bakery-bg); border: 2px solid #6ee7b7; }

        .reference-section h3 {
            font-size: 1.1rem; /* Slightly smaller H3 */
            margin-bottom: 8px; /* Reduced margin */
        }
        
        .rules-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem; /* Smaller table font for mobile */
            margin-bottom: 10px; 
        }

        .rules-table th, .rules-table td {
            padding: 4px 0; /* Reduced vertical padding */
            border-bottom: 1px solid rgba(0,0,0,0.1);
            text-align: left;
            vertical-align: top;
        }
        
        /* Added spacing between table rows for better scannability */
        .rules-table tr {
            margin-bottom: 4px; 
            display: table-row;
        }
        .rules-table tr:last-child td {
            border-bottom: none;
        }
        
        /* Deli Table Specific Separators */
        .deli-rules .rules-table tr:first-child td { padding-top: 8px; }
        .deli-rules .rules-table tr:nth-child(5) td { padding-top: 8px; }


        /* Color Coding for Actions (No Change) */
        .action-cell { font-weight: 700; color: var(--danger); }
        .action-reweight { color: var(--action-reweight); font-weight: 700; }
        .action-sticker { color: var(--action-sticker); font-weight: 700; }
        .action-system { color: var(--action-system); font-weight: 700; }
        .action-combined { color: var(--action-combined); font-weight: 700; }
        
        /* Meat Specific Styles */
        .meat-header-bg {
            background-color: var(--meat-header-bg);
            font-weight: 700;
            padding: 4px 0;
            text-align: center !important;
            font-size: 0.85rem;
        }
        .time-row-bg td {
            background-color: var(--time-row-bg) !important;
        }

        .meat-rules h4 {
            margin-top: 10px; /* Reduced margin */
            margin-bottom: 3px;
            font-size: 0.95rem;
            color: #991b1b;
            border-bottom: 1px solid #991b1b;
            padding-bottom: 2px;
        }

        /* Simplified Action Key for Mobile */
        .action-key {
            font-size: 0.8rem;
            padding: 8px;
            margin-bottom: 10px;
        }
        .action-key span {
            display: block; /* Stack on mobile */
            margin-bottom: 4px;
            margin-right: 0 !important;
            line-height: 1.2;
        }

        /* Ground Meat Specific Rules Box */
        .ground-meat-box {
            padding: 8px;
            margin-top: 8px;
        }
        .ground-meat-box p {
            margin: 4px 0;
            padding-left: 8px;
            font-size: 0.85rem;
        }
        
        /* Ensure Chicken Table is scannable */
        .meat-rules table:nth-of-type(2) {
            margin-bottom: 20px;
        }


        /* DESKTOP/TABLET OPTIMIZATION */
        @media (min-width: 600px) {
            .container { 
                padding: 30px; 
                border-radius: 16px;
                box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            }
            h1 { font-size: 1.5rem; }
            .input-group { gap: 15px; margin-bottom: 25px; }
            .cost-display { padding: 15px; margin-bottom: 25px; }
            .cost-display h2 { font-size: 0.8rem; }
            .cost-display .price-val { font-size: 1.8rem; }
            .discount-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; margin-bottom: 30px; } 
            .original-price { font-size: 0.9rem; }
            .rounded-price { font-size: 1.2rem; }
            
            .reference-section { padding: 15px; }
            .reference-section h3 { font-size: 1.2rem; }
            .rules-table { font-size: 0.85rem; margin-bottom: 15px; }
            .rules-table th, .rules-table td { padding: 6px 0; }
            .rules-table tr { margin-bottom: 0; } /* Reset row margin on desktop */

            .department-grid { 
                flex-direction: row; 
                display: grid; 
                grid-template-columns: 1fr 1fr 1.5fr; 
                gap: 20px;
            }
            .meat-rules { grid-column: span 2; } /* Meat takes up two columns */
            .bakery-rules { grid-column: span 1; }
            
            .action-key span {
                display: inline-block; /* Horizontal layout on desktop */
                margin-right: 15px !important;
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üõí Departmental Markdown Calculator</h1>

    <div class="input-group">
        <div class="input-box">
            <label for="regularPrice">Regular Price ($)</label>
            <input type="number" id="regularPrice" placeholder="0.00" step="0.01">
        </div>
        <div class="input-box">
            <label for="marginPercent">Margin (%)</label>
            <input type="number" id="marginPercent" placeholder="0" step="0.1">
        </div>
    </div>
    
    <div id="managerAlert">
        üö® <u>MANAGER APPROVAL NEEDED</u> üö® (Price is over $15.00)
    </div>

    <div class="cost-display">
        <h2>UNIT COST (0% MARGIN - BREAK EVEN PRICE)</h2>
        <div class="price-val" id="unitCost">$0.00</div>
    </div>

    <label class="discount-label" style="font-weight:700;">Percentage Breakdown (Original Price & Rounded Price)</label>
    <div class="discount-grid" id="discountGrid">
        </div>

    <div class="department-grid">
        
        <div class="reference-section deli-rules">
            <h3>ü•™ Deli Markdowns</h3>
            <table class="rules-table">
                <thead>
                    <tr>
                        <th style="width: 30%;">Price</th>
                        <th style="width: 35%;">Age</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="3" style="background-color: var(--danger); color: white; font-weight: 700; text-align: center; padding: 6px 0;">üö® CRITICAL ALERTS & EXTREME MARKDOWN üö®</td></tr>
                    
                    <tr><td colspan="2">Price <u>Over $15.00</u> (Any Age)</td><td class="action-cell"><u>MANAGER FIRST</u></td></tr>
                    
                    <tr>
                        <td><u>$5.00 - $15.00</u></td>
                        <td>1 Day Left</td>
                        <td class="action-cell">REPRICE TO <u>$1.00 FLAT</u></td>
                    </tr>
                    <tr>
                        <td><u>Under $5.00</u></td>
                        <td>1 Day Left</td>
                        <td class="action-cell">REPRICE TO <u>$0.50 FLAT</u></td>
                    </tr>
                    
                    <tr><td colspan="3" style="background-color: #fef3c7; font-weight: 700; text-align: center; padding: 6px 0;">MAIN MARKDOWNS (Greater than 2 Days Out)</td></tr>
                    
                    <tr><td><u>Under $7.00</u></td><td>Less than 5 Days</td><td class="action-cell"><u>80% OFF</u> (Blowout Sale)</td></tr> 
                    <tr><td><u>$8.00 - $15.00</u></td><td>Less than 5 Days</td><td class="action-cell"><u>70% OFF</u> (Blowout Sale)</td></tr> 
                    
                    <tr><td><u>Under $7.00</u></td><td>5 - 10 Days</td><td class="action-cell">60% OFF</td></tr> 
                    <tr><td><u>$8.00 - $15.00</u></td><td>5 - 10 Days</td><td class="action-cell">50% OFF</td></tr>
                    
                    <tr><td colspan="2">10-15 Days Old (Any Price)</td><td class="action-cell">Apply <u>$1 Sticker</u></td></tr>
                </tbody>
            </table>
        </div>

        <div class="reference-section bakery-rules">
            <h3>üçû Bakery Markdowns (By Shelf Life)</h3>
            <table class="rules-table">
                <thead>
                    <tr>
                        <th style="width: 25%;">Shelf Life</th>
                        <th style="width: 30%;">30% OFF</th>
                        <th>50% OFF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><u>5 Days</u></td><td>2 Days Before Exp</td><td class="action-system">1 Day Left</td></tr>
                    <tr><td><u>7 Days</u></td><td>3 Days Before Exp</td><td class="action-system">2 Days Before Exp</td></tr>
                    <tr><td><u>14 Days</u></td><td>4 Days Before Exp</td><td class="action-system">3 Days Before Exp</td></tr>
                    <tr><td><u>21 Days</u></td><td>5 Days Before Exp</td><td class="action-system">4 Days Before Exp</td></tr>
                    <tr style="background-color: #d1fae5;">
                        <td><u>28 - 30 Days</u></td>
                        <td>N/A</td>
                        <td class="action-system">5 Days Before Exp (<u>50% OFF ONLY</u>)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="reference-section meat-rules" style="grid-column: span 2;"> 
            <h3>ü•© Meat Markdowns (Beef, Pork & Chicken)</h3>
            

            <div class="action-key">
                <u>ACTION KEY</u>: 
                <span class="action-reweight">SCALE REWEIGHT</span> 
                <span class="action-sticker">STICKER MARKDOWN</span> 
                <span class="action-system">SYSTEM DISCOUNT</span>
                <span class="action-combined">(SCALE + $1 STICKER)</span>
            </div>
            
            <h4>1A. BEEF & PORK CUTS (Price & Time-Based) - *No Change*</h4>
            <table class="rules-table">
                <thead>
                    <tr><th style="width: 25%;">Days Out</th><th style="width: 35%;">Price Range</th><th>Action</th></tr>
                </thead>
                <tbody>
                    <tr><td colspan="3" class="meat-header-bg">3 DAYS REMAINING</td></tr>
                    <tr><td>3 Days</td><td><u>Over $10.00</u></td><td class="action-combined">20% OFF <u>(SCALE) + $1 OFF STICKER</u></td></tr>
                    <tr><td>3 Days</td><td><u>$5.00 - $10.00</u></td><td class="action-sticker">30% OFF <u>(STICKER)</u></td></tr>
                    <tr><td>3 Days</td><td><u>Under $5.00</u></td><td class="action-sticker">50% OFF <u>(STICKER)</u></td></tr>
                    
                    <tr><td colspan="3" class="meat-header-bg">2 DAYS REMAINING</td></tr>
                    <tr><td>2 Days</td><td><u>Over $10.00</u></td><td class="action-combined">30% OFF <u>(SCALE) + $1 OFF STICKER</u></td></tr>
                    <tr><td>2 Days</td><td><u>$5.00 - $10.00</u></td><td class="action-sticker">50% OFF <u>(STICKER)</u></td></tr>
                    <tr><td>2 Days</td><td><u>Under $5.00</u></td><td class="action-sticker">50% OFF <u>(STICKER)</u></td></tr>

                    <tr><td colspan="3" class="meat-header-bg">1 DAY REMAINING (TIME-BASED)</td></tr>
                    <tr class="time-row-bg">
                        <td rowspan="3">1 Day <br>(8:00 AM - 2:00 PM)</td>
                        <td><u>Over $10.00</u></td>
                        <td class="action-combined">50% OFF <u>(SCALE) + $1 OFF STICKER</u></td>
                    </tr>
                    <tr class="time-row-bg">
                        <td><u>$5.00 - $10.00</u></td>
                        <td class="action-sticker">50% OFF <u>(STICKER)</u></td>
                    </tr>
                    <tr class="time-row-bg">
                        <td><u>Under $5.00</u></td>
                        <td class="action-sticker">50% OFF <u>(STICKER)</u></td>
                    </tr>
                    <tr class="time-row-bg">
                        <td rowspan="3">1 Day <br>(2:00 PM - EOD)</td>
                        <td><u>Over $10.00</u></td>
                        <td class="action-combined">70% OFF <u>(SCALE) + $1 OFF STICKER</u></td>
                    </tr>
                    <tr class="time-row-bg">
                        <td><u>$5.00 - $10.00</u></td>
                        <td class="action-combined">70% OFF <u>(SCALE) + $1 OFF STICKER</u></td>
                    </tr>
                    <tr class="time-row-bg">
                        <td><u>Under $5.00</u></td>
                        <td class="action-combined">70% OFF <u>(SCALE) + $1 OFF STICKER</u></td>
                    </tr>
                </tbody>
            </table>

            <h4>1B. CHICKEN CUTS & PACKS (Scale Reweight + $1 Sticker Logic)</h4>
            <table class="rules-table">
                <thead>
                    <tr>
                        <th style="width: 25%;">Item</th>
                        <th>4 Days Out (Original Price/Kg)</th>
                        <th>3 Days Out (10% Off Reweight)</th>
                        <th>2 Days Out (20% Off Reweight)</th>
                        <th>1 Day Out (40% Off Reweight)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="chicken-header-bg"><td colspan="5">SCALE REWEIGHT + $1.00 STICKER REQUIRED FOR ALL DAYS</td></tr>
                    
                    <tr class="chicken-bg-row">
                        <td>Wings VP</td>
                        <td class="action-combined"><u>$10.30/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$9.27/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$8.24/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$6.18/kg</u> + $1 Sticker</td>
                    </tr>
                    <tr class="chicken-bg-row">
                        <td>Legs Back Attached VP</td>
                        <td class="action-combined"><u>$6.59/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$5.93/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$5.27/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$3.95/kg</u> + $1 Sticker</td>
                    </tr>
                    <tr class="chicken-bg-row">
                        <td>Breast Bone in Back Attached</td>
                        <td class="action-combined"><u>$10.39/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$9.35/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$8.31/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$6.23/kg</u> + $1 Sticker</td>
                    </tr>
                    <tr class="chicken-bg-row">
                        <td>Drums VP</td>
                        <td class="action-combined"><u>$6.00/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$5.40/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$4.80/kg</u> + $1 Sticker</td>
                        <td class="action-combined"><u>$3.60/kg</u> + $1 Sticker</td>
                    </tr>
                    
                    <tr class="chicken-header-bg"><td colspan="5">FIXED DOLLAR/PERCENTAGE-OFF MARKDOWNS (STICKER ONLY)</td></tr>
                    <tr>
                        <td>Chicken Breast 4pk</td>
                        <td class="action-sticker"><u>$1 OFF STICKER</u></td>
                        <td class="action-sticker"><u>$1 OFF STICKER</u></td>
                        <td class="action-sticker"><u>30% OFF STICKER</u></td>
                        <td class="action-sticker"><u>50% OFF STICKER</u></td>
                    </tr>
                    <tr>
                        <td>Legs Back Attached 4pk</td>
                        <td class="action-sticker"><u>$2 OFF STICKER</u></td>
                        <td class="action-sticker"><u>$2 OFF STICKER</u></td>
                        <td class="action-sticker"><u>30% OFF STICKER</u></td>
                        <td class="action-sticker"><u>50% OFF STICKER</u></td>
                    </tr>
                </tbody>
            </table>
            
            <h4>2. GROUND MEAT & SAUSAGES (Sticker Priority) - *No Change*</h4>
            <table class="rules-table">
                <thead>
                    <tr><th style="width: 35%;">Days Out</th><th style="width: 35%;">Criteria</th><th>Action</th></tr>
                </thead>
                <tbody>
                    <tr><td colspan="3" class="meat-header-bg">SAUSAGES, GROUND CHICKEN, TURKEY, PORK</td></tr>
                    <tr><td>3 Days</td><td><u>Any Under $5.00</u></td><td class="action-sticker">30% OFF <u>(STICKER)</u></td></tr>
                    <tr><td>2 Days</td><td><u>Any Under $5.00</u></td><td class="action-sticker">50% OFF <u>(STICKER)</u></td></tr>
                    
                    <tr><td colspan="3" class="meat-header-bg">GROUND BEEF ONLY</td></tr>
                    <tr class="time-row-bg">
                           <td>1 Day Left</td>
                           <td>Any Price</td>
                           <td class="action-sticker">50% OFF <u>(STICKER) STARTING 4:00 PM</u></td>
                    </tr>
                </tbody>
            </table>

            <div class="ground-meat-box">
                <p style="font-weight: 700; color:#991b1b;">1 DAY REMAINING - FINAL LOGIC (STOCK & TIME DEPENDENT)</p>
                <p>‚Äî <u>Ground Pork, Chicken, Turkey, Sausages</u>: <span class="action-sticker">50% OFF <u>(ALL DAY STICKER)</u></span></p>
                <p style="border-left: 3px solid var(--action-system);">‚Äî <u>HIGH VOLUME STOCK (Any Ground)</u>: <span class="action-system">70% <u>SYSTEM DISCOUNT (Confirm with Manager)</u></span></p>
            </div>
        </div>
    </div>
</div>

<script>
    const priceInput = document.getElementById('regularPrice');
    const marginInput = document.getElementById('marginPercent');
    const unitCostDisplay = document.getElementById('unitCost');
    const discountGrid = document.getElementById('discountGrid');
    const managerAlert = document.getElementById('managerAlert');

    function formatMoney(amount) {
        // Standard formatter for displaying exact numbers (like original calculation and unit cost)
        const finalAmount = Math.max(0, amount); 
        return '$' + finalAmount.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function formatMoneyRounded(amount) {
        // Formatter specifically for the rounded price (ensures .48 or .98 ending)
        const finalAmount = Math.max(0, amount);
        
        if (finalAmount < 0.01) {
            return '$0.00';
        }

        const dollars = Math.floor(finalAmount);
        // Round to nearest cent before checking (handles floating point nuances)
        const cents = Math.round((finalAmount - dollars) * 100);

        let formattedCents;

        // Determine if the price ends in .48 or .98 based on the rounding logic
        // Checks if cents are closer to 98 or 48/50
        if (cents >= 75 || Math.abs(cents - 98) < 10) { 
            formattedCents = '98';
        } else if (cents >= 25) { 
            formattedCents = '48';
        } else {
             return '$' + dollars.toLocaleString('en-US', { maximumFractionDigits: 0 }) + '.48';
        }

        return '$' + dollars.toLocaleString('en-US', { maximumFractionDigits: 0 }) + '.' + formattedCents;
    }


    function calculateNearestPrice(price) {
        if (price <= 0) return 0;
        
        const isWholeDollar = Math.abs(price - Math.round(price)) < 0.001 && price > 0.99; 

        if (isWholeDollar) {
            
            if (price >= 3.00) {
                 const dollarBelow = Math.floor(price) - 1;
                 return dollarBelow + 0.98;
            }
            
            if (price < 3.00) {
                return 0.98;
            }
        }
        
        const priceFloor = Math.floor(price);
        const cents = Math.round((price - priceFloor) * 100);

        let roundedPrice;

        if (cents >= 50) {
            roundedPrice = priceFloor + 0.98;
            
        } else {
            
            if (price < 0.48) {
                 return 0.48; 
            }
            
            roundedPrice = priceFloor + 0.48;
        }

        return roundedPrice;
    }

    function calculate() {
        const regularPrice = parseFloat(priceInput.value);
        const margin = parseFloat(marginInput.value);

        if (isNaN(regularPrice)) {
            unitCostDisplay.textContent = "$0.00";
            discountGrid.innerHTML = ''; 
            managerAlert.style.display = 'none';
            return;
        }

        // --- 1. Manager Alert Logic (Price only) ---
        managerAlert.style.display = (regularPrice > 15) ? 'block' : 'none';

        // --- 2. Unit Cost Logic ---
        let cost = regularPrice;
        if (!isNaN(margin)) {
            cost = regularPrice * (1 - (margin / 100));
        }
        unitCostDisplay.textContent = formatMoney(cost);

        // --- 3. Discount Loop (10% to 90%) ---
        discountGrid.innerHTML = '';
        const percentages = [10, 20, 30, 40, 50, 60, 70, 80, 90];
        
        for (let i = 0; i < percentages.length; i++) {
            const percentage = percentages[i];
            const discountFactor = 1 - (percentage / 100);
            let discountedPrice = regularPrice * discountFactor;
            
            let roundedPrice = calculateNearestPrice(discountedPrice);
            
            const box = document.createElement('div');
            box.className = 'discount-card';
            
            const displayPercent = `-${percentage}%`;
            const displayOriginalPrice = formatMoney(discountedPrice);
            const displayRoundedPrice = formatMoneyRounded(roundedPrice); 
            
            const costDiff = Math.abs(discountedPrice - cost);
            if (costDiff < 0.05) { 
                 box.classList.add('cost-highlight'); 
            }

            box.innerHTML = `
                <div class="discount-percent">${displayPercent}</div>
                <div class="discount-price-container">
                    <span class="original-price">(${displayOriginalPrice})</span>
                    <span class="rounded-price">${displayRoundedPrice}</span>
                </div>
            `;
            discountGrid.appendChild(box);
        }
    }

    priceInput.addEventListener('input', calculate);
    marginInput.addEventListener('input', calculate);
    
    // Run calculation once on load
    calculate();
</script>

</body>
</html>
